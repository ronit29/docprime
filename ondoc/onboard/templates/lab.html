{%extends 'base.html'%}
{% load crispy_forms_tags %}
{% load staticfiles %}

{% block header %}
<div class='' style='background: #00acc1;height: 50px;color:#fff;font-size: 18px;padding:13px 0;'>
    <div class="container">
    <div class='row'>    
    <div class='col-md-3 col-xs-6 col-sm-6'>Panacea Techno</div>
    <div class='col-md-6 col-xs-6 col-sm-6' style='text-align: center;'>WELCOME {{ lab_form.name.value|default_if_none:"" }}</div>
    </div>    
    </div>                
</div>    
{% endblock %}

{% block content %}

    <link rel="stylesheet" href="{% static 'css/basic.css' %}">
    <link rel="stylesheet" href="{% static 'css/dropzone.css' %}">
    <link rel="stylesheet" href="{% static 'css/lab.css' %}">

<div style='padding:40px 0 20px 0'>
	<form class="form-horizontal" method="POST" action="">

    <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/1.png' %}" >
        <span>BASIC DETAILS</span></div>
      <div class="panel-body">
            {% crispy lab_form %}           

      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">SERVICES</div>
      <div class="panel-body">

        <div class='row'>
        <div class='col-md-5'>    
        <div class='clearfix'>   
         {% for id, name in LabService.SERVICE_CHOICES %}


 
        <div {% if forloop.last %} class='col-md-3 col-md-offset-3 col-sm-6 col-xs-6' {% else %} class='col-md-6 col-sm-6 col-xs-6' {% endif %}>
            <div class="form-group"> 
                <div class="controls "> 
                    <div id="div_id_labservice-0-service" class="checkbox"> 
                        <label for="id_labservice-0-service" style="color: black;font-size: 14px;"> 
                        <input type="checkbox" name="labservice-0-service" class="checkboxinput" field-class="col-md-6" id="id_labservice-0-service" label-class="hidden">
                        <input type='text' class="hidden" value = "{{id}}">
                        {{name}}
                        </label> 
                    </div> 
                </div> 
            </div>
        </div>  
         {% endfor%}
        </div>
        <div>
        <p style='font-size: 12px;color:#00AAC5;margin:30px 0;'>Doctors For Radiology</p>
         {{ lab_doctor_availability_formset.management_form|crispy }}
        <div class='clearfix' style='font-size: 14px;'>
            <div class='col-md-6 col-sm-6 col-xs-6'></div>
            <div class='col-md-5 col-md-offset-1 col-sm-6 col-xs-6'>
                <div class='col-md-6 col-sm-6 col-xs-6'>Male</div>
                <div class='col-md-6 col-sm-6 col-xs-6'>Female</div>
            </div>
        </div>


         {% for form in lab_doctor_availability_formset %}
         <div class="form-horizontal">
              {% crispy form %}
         </div>
         {% endfor %}

       </div>
        </div>
        <div class='col-md-6 col-md-offset-1'>
            <div class='col-md-6'>
                <p style='font-size: 12px;margin-top: 9;color:#00AAC5;'>Doctor's MCI Registration Number</p>
            </div>
            <div class='col-md-6'>
            
             {{ lab_doctor_formset.management_form|crispy }}
             {% for form in lab_doctor_formset %}
             <div class="form-horizontal">
                  {% crispy form %}
             </div>
             {% endfor %}
             <div style='font-size: 16px;'>
                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                <span>Add Another</span>
            </div>
             </div>

        </div>

        </div>




      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/3.png' %}" >
        <span>ADDRESS</span>
      </div>
      

      <div class="panel-body">
      <div class="row">
      <div class='col-md-6 address'>{{address}}</div>
      <div class='col-md-6' >
          <div id="gmap" style="width:100%;height:160px;"></div>
      </div>
      </div>
      <div style='padding:40px 0;'></div>
            {% crispy lab_address_form %}
      </div>
    </div>


    <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/4.png' %}">
        <span>LAB CERTIFICATIONS</span></div>
      <div class="panel-body">
        {{ certificates_formset.management_form|crispy }}
         {% for form in certificates_formset %}
         <div class="form-horizontal">
              {% crispy form %}
         </div>
         {% endfor %}


      </div>
      <div class='panel-footer'>
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        <span>Add Another Lab Certification</span>
      </div>
    </div>


    <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/5.png' %}">
        <span>LAB AWARDS</span></div>
      <div class="panel-body">
        {{ award_formset.management_form|crispy }}
         {% for form in award_formset %}
         <div class="form-horizontal">
              {% crispy form %}
         </div>
         {% endfor %}
      </div>
      <div class='panel-footer'>
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        <span>Add Another Award</span>
      </div>
    </div>


    <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/6.png' %}">
        <span>LAB ACCREDITATIONS</span></div>
      <div class="panel-body">
        {{ accreditation_formset.management_form|crispy }}
         {% for form in accreditation_formset %}
         <div class="">
              {% crispy form %}
         </div>
         {% endfor %}
      </div>
      <div class='panel-footer'>
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        <span>Add Another Lab Accreditation</span>
      </div>

    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/7.png' %}">
        <span>LAB CONTACT DETAILS</span></div>
      <div class="panel-body" style='padding-right: 20px;'>


        <!-- Adding formsets for awards -->
        {{ lab_manager_formset.management_form }}
        {% for form in lab_manager_formset %}        
        <div class="" style='margin-bottom: 30px;'>
              {% crispy form %}
        </div>
        {% endfor %}
      </div>
     <div class='panel-footer'>
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        <span>Add Another Lab Contact</span>
      </div>

    </div>



    <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/8.png' %}">
        <span>LAB Timings</span></div>
      <div class="panel-body">

        <div class='col-md-12'>
        {% crispy lab_open_form %}
        </div>
        <!-- Adding formsets for awards -->
        {{ lab_timing_formset.management_form }}
        {% for form in lab_timing_formset %}        
        <div style='margin-left: 40px'>
              {% crispy form %}
        </div>
        {% endfor %}
      </div>
     <div class='panel-footer'>
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        <span>Add Another Lab Timings</span>
      </div>

    </div>

	<input class="submit btn btn-primary pull-right" type="submit" value="Submit data">
	</form>


      <div class="panel panel-default">
      <div class="panel-heading">AGREED RATE LIST</div>
      <div class="panel-body">
      </div>  
      </div>
      

      <div class="panel panel-default">
      <div class="panel-heading">
        <img class='heading-icon' src ="{% static 'images/10.png' %}">
        <span>LAB IMAGE</span></div>
      <div class="panel-body">
      <div class='upload-container' data-media='image' data-type='' data-url='/onboard/upload' data-max='5'  style='text-align: left;display: inline-block;min-width: 33%;vertical-align: top;margin-bottom: 30px;'>

        {% for img in lab_images %}
            <div class="existing-image" style="vertical-align: top; margin: 10px 10px 0 0; display: inline-block;">
            <img width="120" height="120" src='{{img.name.url}}'>

            </div>            
        {% endfor %}

        {% if lab_images.count < 5 %}
        <div class="image-upload dropzone dz-clickable" style="border:none;padding:0;display: inline-block;min-height: 10px;overflow: hidden;">
        </div>
        <div style="display: inline-block;vertical-align:top;padding:30px 0 0 0;text-align: left;cursor:pointer;" class='trigger-upload'>
            <img style='margin-left:15px;' class="upload-icon" src="{% static 'images/group-1.png' %}">
            <div style="padding-top: 10px;">Upload image</div>
        </div>
        {% endif %}
        </div>


      </div>    

    </div>

    <div class="panel panel-default">
      <div class="panel-heading">DOCUMENTS</div>
      <div class="panel-body">
        {% for id,data in lab_doc_dict.items %}

        {% with results=data.2 %}

        {% if id == LabDocument.ADDRESS %}
            <div class='upload-container' data-media='document' data-type='{{id}}' data-url='/onboard/upload' data-max='3'  style='text-align: left;display: inline-block;min-width: 33%;vertical-align: top;margin-bottom: 30px;'>
        {% else %}
            <div class='upload-container' data-media='document' data-type='{{id}}' data-url='/onboard/upload' data-max='1'  style='text-align: left;display: inline-block;min-width: 33%;vertical-align: top;margin-bottom: 30px;'>
        {% endif %}

        {% if results %}
        <div style='color:#00AAC5; font-weight: bold;'>{{forloop.counter}}. {{data.1}}</div>
            {% for instance in results %}

            <div class="existing-image" style="vertical-align: top; margin: 10px 10px 0 0; display: inline-block;">

                <img width="120" height="120" src='{{instance.name.url}}'>

            </div>
            {% endfor %}
        {% if results.count < 1 or results.count < 3 and id == LabDocument.ADDRESS %}    
        <div class="image-upload dropzone dz-clickable" style="border:none;padding:0;display: inline-block;min-height: 10px;overflow: hidden;">
        </div>
        <div style="display: inline-block;vertical-align:top;padding:30px 0 0 0;text-align: left;cursor:pointer;" class='trigger-upload'>
            <img style='margin-left:15px;' class="upload-icon" src="{% static 'images/group-1.png' %}">
            <div style="padding-top: 10px;">Upload image</div>
        </div>
        {% endif %}    

        {% else %}

        <div>
        <div style='color:#00AAC5; font-weight: bold;'>{{forloop.counter}}. {{data.1}}</div>

        <div class="image-upload dropzone dz-clickable" style='border:none;padding:0;display: inline-block;min-height: 10px;overflow: hidden;'>
        </div>
        <div style="display: inline-block;vertical-align:top;padding:30px 0 0 0;text-align: left;cursor:pointer;" class='trigger-upload'>
            <img style='margin-left:15px;' class="upload-icon" src="{% static 'images/group-1.png' %}">
            <div style="padding-top: 10px;">Upload image</div>
        </div>

        </div>
        {% endif %}
        </div>
        {% endwith %}        

        {% endfor %}


      </div>    

    </div>

</div>

<div style='font-size: 16px;margin-bottom:30px;'>I hereby agree to the terms and conditions governing the  empanelment with the company.</div>

<button class='btn pull-right' style='background-color:#00acc1;min-width: 180px;height: 40px;color: white;'>Submit</button>
<button class='btn pull-right' style='margin-right:20px;background-color:#979797;min-width: 180px;height: 40px;color: white;'>Save Draft</button>

<div style='padding-top:100px'></div>
{% endblock %}

{% block domready %}

$('.trigger-upload').on('click',function(e){
    $(this).closest('.upload-container').find('.dropzone').trigger('click')

})

$('.image-upload').each(function(x){

    var data = $(this).closest('.upload-container').data()
    $(this).dropzone({

    init: function() 
    {
        this.on("success", function(file) { 

           var existing  =  $(this.element).closest('.upload-container').find('.existing-image').length

           if((this.files.length+existing) >= this.options.maxFiles) 
           {
                $(this.element).closest('.upload-container').find('.trigger-upload').addClass('hidden')
            }
        });

        this.on("error", function(file) {
             this.removeFile(file);
        });

    },
    paramName: 'name',
    url: data.url,
    dictDefaultMessage : '',
    maxFiles:data.max,
    uploadMultiple:false,
    maxFilesize:data.max,
    params: {'csrfmiddlewaretoken': $.cookie('csrftoken'),'document_type':data.type, 'media':data.media}
})

});

{% endblock %}

